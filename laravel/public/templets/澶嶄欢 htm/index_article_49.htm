<!DOCTYPE html>
<html><head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />

    <title>{dede:field.title/}_{dede:global.cfg_webname/}</title>
    <meta name="keywords" content="{dede:field.keywords/}" />
    <meta name="description" content="{dede:field.description  function='html2text(@me)'/}" />
    
    {dede:include filename="js.htm"/}
    
<script type="text/javascript" language="javascript">
//验证码 
function changeAuthCode() { 
    var num =     new Date().getTime();
    var rand = Math.round(Math.random() * 10000);
    num = num + rand;
    $('#ver_code').css('visibility','visible');
    if ($("#vdimgck")[0]) {
        $("#vdimgck")[0].src = "../include/vdimgck.php?tag=" + num;
    }
    return false;    
}
</script>

    
    <script src="{dede:global.cfg_templets_skin/}/style/js/jquery-1.9.1.js"></script>
<script src="{dede:global.cfg_templets_skin/}/style/js/base.min.js"></script>
<script src="{dede:global.cfg_templets_skin/}/style/js/common.js"></script>
<script src="{dede:global.cfg_templets_skin/}/style/js/g.js"></script>

    <link href="{dede:global.cfg_templets_skin/}/style/css/common.min.css" rel="stylesheet"/>



    
    <link href="{dede:global.cfg_templets_skin/}/style/css/emailSubscribe.css" rel="stylesheet" />
    <link href="{dede:global.cfg_templets_skin/}/style/css/datepicker.min.css" rel="stylesheet" />
    <link href="{dede:global.cfg_templets_skin/}/style/css/rangeSlider.css" rel="stylesheet" />
    <style>

        footer {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
        }
    </style>



    <script type="text/javascript">


        var zd = '0';
        if (zd == 0 && getCookie("zd") == null) {
            document.write('<script src="{dede:global.cfg_templets_skin/}/style/js/p.mini.js"><\/script>');
        } else {
            if (zd == 1 && getCookie("zd") == null)
                addCookie(1);
        }

        function addCookie(objHours) {
            var str = "zd=1";
            var date = new Date();
            var ms = 1000 * 60 * 10;
            date.setTime(date.getTime() + ms);
            str += "; expires=" + date.toGMTString();
            document.cookie = str;
        }
        function getCookie(name) {
            var arr = document.cookie.match(new RegExp("(^| )" + name + "=([^;]*)(;|$)"));
            if (arr != null) return unescape(arr[2]); return null;
        }
        function delCookie(name) {
            var exp = new Date();
            exp.setTime(exp.getTime() - 1);
            var cval = getCookie(name);
            if (cval != null) document.cookie = name + "=" + cval + ";expires=" + exp.toGMTString();
        }
        var mlik = document.getElementsByTagName("mLink");
        mlik.onclick = function () {
            delCookie("zd");
        }

    </script>

</head>
<body data-spy="scroll">
    <input id="controller" type="hidden" value="Service" />
    <input id="action" type="hidden" value="email_delivery" />
    

{dede:include filename="head.htm"/}


    


<div class="container">
    <ol class="breadcrumb">
        <li><a href="{dede:global.cfg_indexurl/}">首页</a></li>
        <li class="active">订阅邮箱</li>
    </ol>
    <h4 class="page-header">订阅我想要的房源 <small> EMAIL SUBSCRIPTION</small></h4>


<form action="/plus/diy.php" enctype="multipart/form-data" method="post">
<input type="hidden" name="action" value="post" />
<input type="hidden" name="diyid" value="3" />
<input type="hidden" name="do" value="2" />


    <div class="form-horizontal" role="form" novalidate="novalidate">
        <div class="form-group">
            <label for="" class="col-sm-3 control-label">订阅区域：</label>
            <div class="col-sm-2" id="divregion">
                <select name='q1' class="form-control region">
                    <option value="0">请选择</option>
                        <option value="青羊区">青羊区</option>
                        <option value="武侯区">武侯区</option>
                        <option value="成华区">成华区</option>
                        <option value="金牛区">金牛区</option>
                        <option value="锦江区">锦江区</option>
                        <option value="高新区">高新区</option>
                        <option value="高新西区">高新西区</option>
                </select>
            </div>
            <div class="col-sm-2">
 <input type="text"  name='q2' class="form-control" value="请输区域地址" onfocus="if (value =='请输区域地址'){value =''}" onblur="if (value ==''){value='请输区域地址'}"  >
            </div>
        </div>
        <div class="form-group">
            <label for="" class="col-sm-3 control-label">价格范围：</label>
            <div class="col-sm-4">
                <input type="hidden" id="price-change" />
                <input name="minprice" type="hidden" id="minprice" class="hidminprice" value="500">
                <input name="maxprice" type="hidden" id="maxprice" class="hidmaxprice" value="1500">
            </div>
        </div>
        <div class="form-group">
            <label for="" class="col-sm-3 control-label">最晚入住：</label>
            <div class="col-sm-4">
                <input type="text" name='q4' class="form-control contract_time_today" id="checkontime">
            </div>
        </div>
        <div class="form-group hidden send-time">
            <label for="" class="col-sm-3 control-label">发送周期：</label>
            <div class="col-sm-9">
                <div class="radio-inline send-style-1 tips" title="火速通知：第一时间告知你新鲜房源信息，缺点，可能会被多次骚扰">
                    <label>
                        <input type="radio" name="optionsradios" id="send-1" value="立即通知" checked="">立即通知
                    </label>
                </div>
                <div class="radio-inline send-style-2 hidden">
                    <label>
                        <input type="radio" name="optionsradios" id="send-2" value="每天通知我一次">每天通知我一次
                    </label>
                </div>
                <div class="radio-inline send-style-3 hidden">
                    <label>
                        <input type="radio" name="optionsradios" id="send-3" value="提前一周通知我">提前一周通知我
                    </label>
                </div>
                <div class="radio-inline send-style-4 hidden">
                    <label>
                        <input type="radio" name="optionsradios" id="send-4" value="提前一月通知我">提前一月通知我
                    </label>
                </div>
            </div>
        </div>
        <div class="form-group">
            <label for="" class="col-sm-3 control-label">邮箱地址：</label>
            <div class="col-sm-4">
                <input type="text" name='q5' class="form-control" id="UserEmail" check-type="mail">
            </div>
        </div>
        
        <div class="form-group">
        
            <label for="" class="col-sm-3 control-label">验证码：</label>
            
            <div class="col-sm-4">
            
<input name="validate" type="text" id="vdcode" style="text-transform:uppercase;" size="8"/> 
<img id="vdimgck" align="absmiddle" onClick="this.src=this.src+'?'" style="cursor: pointer;" alt="看不清？点击更换" src="../include/vdimgck.php"/>  
<a href="javascript:vide(-1);" onClick="changeAuthCode();">看不清？ </a> 

            </div>
        </div>
        
        <div class="form-group">
            <div class="col-sm-offset-3 col-sm-4">
            
            <input type="hidden" name="dede_fields" value="q1,text;q2,text;minprice,text;q4,text;optionsradios,text;q5,text" />
<input type="hidden" name="dede_fieldshash" value="070c8ce6c5f4a7097c79a41b8c89d2c7" />

               
                <button type="submit"  name="submit" class="btn  btn-orange btn-flat btn-valid">提 交</button>
                <input type="reset" name="reset" value="重 置" class='btn btn-default btn-flat' />


            </div>
        </div>
        <div class="bk30"></div>
    </div>
    </form>


</div>


<div class="modal fade email-modal" id="email-callback" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">

            <div class="modal-body text-center">
                <h3 class="text-orange"><strong id="alertmsg">订阅成功</strong></h3>
                <p class="text-left">HI 同学：</p>
                <p class="text-left message">
                    您订阅的<span class="text-orange">锦江区 / 500-700 / 单间 / 立即入住</span>的房源需求，外星人已收到。<br />科学家们会按照您的要求，为您及时推送房源信息，么么哒~
                </p>
                <!--
                    订阅失败
                    1、科学家们很聪明的，相同的内容不用重复订阅哦~

                  2、SORRY，订阅失败。
                  科学家正在攻破这个世界难题，请换个姿势再试一次。
                    -->
                <div class="bk20"></div>
                <button type="button" class="btn btn-orange btn-flat" id="close" data-dismiss="modal">关闭</button>
            </div>

        </div>
    </div>
</div>





  {dede:include filename="footer.htm"/}
  
   <script src="{dede:global.cfg_templets_skin/}/style/js/ion.rangeSlider.min.js"></script> 
    <script src="{dede:global.cfg_templets_skin/}/style/js/validation.min.js"></script> 
    <script src="{dede:global.cfg_templets_skin/}/style/js/bootstrap-datepicker.js"></script>
    <script>
    $("#price-change").ionRangeSlider({
        min: 0,
        max: 8000,
        from: 800,
        to: 8000,
        type: 'double',
        step: 100,
        postfix: " 元",
        hasGrid: true,
        onChange: function (obj) {
            $(".hidminprice").val(obj.fromNumber);
            $(".hidmaxprice").val(obj.toNumber);
            //console.log(obj.fromNumber, obj.toNumber);
        },
    });
</script>
    <script>
    $('.contract_time_today').datepicker({
        todayBtn: "linked",
        format: 'yyyy/mm/dd',
        language: "zh-CN",
        startDate: '-0d',
        autoclose: true,

    });
    $(document).on('changeDate', ".contract_time_today", function (ev) {
        $(".send-time").removeClass("hidden");
        var startTime = ev.date.valueOf();
        var NowDay = Date.parse(new Date());
        var day = Math.floor((startTime - NowDay) / (1000 * 60 * 60 * 24)) + 1;
        if (day > 7 && day <= 30) {
            $(".send-style-2,.send-style-4").addClass("hidden");
            $(".send-style-3").removeClass("hidden");
        } else if (day <= 7) {
            $(".send-style-3,.send-style-4").addClass("hidden");
            $(".send-style-2").removeClass("hidden");
        } else if (day > 30) {
            $(".send-style-3,.send-style-4").removeClass("hidden");
            $(".send-style-2").addClass("hidden");
        }

    });
    </script>
    <script>
    var valid = $(".form-horizontal").validation();
    $(document).on('click', ".btn-valid", function (event) {
        //$("input[name='optionsRadios']:checked")[0].nextSibling.nodeValue;
        if ($(".region").val() == 0 || !$("#UserEmail").val())
        {
            alert("请选择区域，填写邮箱");
            return;
        }
        var proData = "regionid=" + $(".region").val();
        proData += "&parentid=" + $(".parentid").val() + "&checkontime=" + $("#checkontime").val() + "&SendDate=" + $('input:radio:checked').val() + "&UserEmail=" + $("#UserEmail").val() + "&minprice=" + $("#minprice").val() + "&maxprice=" + $("#maxprice").val() + "&date=" + new Date().getTime();
        $.ajax({
            type: "POST",
            url: "/Service/SaveSubscibe",
            data: proData,
            success: function (data) {
                if (data.result > 0) {
                    $(".message").html(" 您订阅的<span class=\"text-orange\">" + $(".region").find("option:selected").text() + " / " + $("#minprice").val() + "-" + $("#maxprice").val() + " /" + "</span>的房源需求，外星人已收到。<br/>科学家们会按照您的要求，为您及时推送房源信息，么么哒~</p>");
                    $("#email-modal").modal('hide');
                    $("#email-callback").modal('show');
                } else if (data.result == -1) {
                    $("#alertmsg").html("订阅失败");
                    $(".message").html(" 订阅失败!你已经订阅过了哟~");
                    $("#email-modal").modal('hide');
                    $("#email-callback").modal('show');
                }
                else {
                    $("#alertmsg").html("订阅失败");
                    $(".message").html("SORRY，订阅失败。科学家正在攻破这个世界难题，请换个姿势再试一次。");
                    $("#email-modal").modal('hide');
                    $("#email-callback").modal('show');
                }
            },
            error: function (errorThrown) {
                $("#alertmsg").html("订阅失败");
                $(".message").html("SORRY，订阅出现异常。科学家正在攻破这个世界难题。");
                $("#email-modal").modal('hide');
                $("#email-callback").modal('show');
            },
        });
    });

    $(function () {
        $(".region").on("change", function () {
            var proData = "regionId=" + $(this).val();
            $.ajax({
                type: "POST",
                url: "/Service/GetPlate",
                data: proData,
                dataType: "JSON",
                success: function (data) {
                    $(".parentid").empty();
                    $(".parentid").append($("<option Value='0'>全部</option>"));
                    for (var i = 0; i < data.length; i++) {
                        $(".parentid").append($("<option value='" + data[i].PlateId + "'>" + data[i].Name + "</option>"));
                    }
                }
            });
        });
    });

    $(document).on('click', "#close", function (event) {
        location.href = '/';
    });

</script>



    <script type="text/javascript">

        $(document).ready(function () {
            Custom.init();
            SetNavClass('member-nav', 'active');
            SetNavClass('uoko-nav', 'active');
        });
        window._bd_share_config = {
            common: {
                "bdSnsKey": {},
                "bdText": "",
                "bdMini": "2",
                "bdMiniList": !1,
                "bdPic": "",
                "bdStyle": "0",
                "bdSize": "16",
                bdMini: 2,
                bdPopupOffsetLeft: -207
            },
            share: [{
                "bdSize": 16
            }]
        }
        with (document) 0[(getElementsByTagName('head')[0] || body).appendChild(createElement('script')).src = 'http://bdimg.share.baidu.com/static/api/js/share.js?cdnversion=' + ~(-new Date() / 36e5)];


        function SetNavClass(ulId, className) {
            var controller = $('#controller').val();
            var action = $('#action').val();
            eval('controller_' + controller + ' = true');
            eval('action_' + action + ' = true');
            var list = $('#' + ulId + ' *');

            for (var k = 0; k < list.length; k++) {
                var item = list[k];
                var str = GetClassName(item);
                var navClass;
                navClass = $(item).attr('data-menu-active-class');
                if (navClass == null || navClass == '') {
                    navClass = className;
                }
                try {
                    if (eval(str)) $(item).addClass(navClass);
                } catch (e) { }
            }
        }
        function GetClassName(item) {
            var classStr = $(item).attr('data-menu-active');
            if (classStr == null) return "";
            var classes = classStr.split(' ');
            for (var k = 0; k < classes.length; k++) {
                if (classes[k].indexOf('controller') > -1 || classes[k].indexOf('action') > -1) return classes[k];
            }
        }


        $(".aboutList").hover(function () {
            $(".aboutList").css({
                "background": "#2CBCB8"
            })
            $(".aboutUoko").stop(true, true).fadeIn(300);

        }, function () {
            $(".aboutList").css({
                "background": "#3FCBC0"
            })
            $(".aboutUoko").stop(true, true).fadeOut(300);
        });

    </script>

</body>

</html>
